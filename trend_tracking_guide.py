#!/usr/bin/env python3
"""
Trend Tracking and Report Comparison Guide
Complete guide and examples for memory leak trend analysis and report comparison
"""

import sys
from pathlib import Path

def print_guide():
    """Print comprehensive guide for report comparison and trend tracking"""
    
    print("ğŸ” MEMORY LEAK TREND TRACKING & REPORT COMPARISON GUIDE")
    print("=" * 80)
    
    print("\nğŸ“Š WHAT IS TREND ANALYSIS?")
    print("-" * 40)
    print("Trend analysis tracks memory leaks over time to identify:")
    print("â€¢ ğŸ“ˆ Regressions - New memory leaks introduced")
    print("â€¢ ğŸ“‰ Improvements - Memory leaks fixed")  
    print("â€¢ ğŸ”„ Patterns - Recurring issues")
    print("â€¢ ğŸ“‹ Progress - Overall memory health trends")
    
    print("\nğŸ”„ HOW TRENDS WORK")
    print("-" * 40)
    print("1. ğŸ“ Each test run records a 'trend point' with:")
    print("   â€¢ Version/build identifier")
    print("   â€¢ Total leak count and bytes")
    print("   â€¢ Leak breakdown by type and severity")
    print("   â€¢ Timestamp and metadata")
    
    print("\n2. ğŸ“Š Historical data is stored in SQLite database:")
    print("   â€¢ ~/.memory_leak_analyzer/trends.db")
    print("   â€¢ Automatically tracks all runs")
    print("   â€¢ Provides long-term memory health view")
    
    print("\n3. ğŸ” Comparisons identify:")
    print("   â€¢ New leaks (fingerprint-based matching)")
    print("   â€¢ Fixed leaks (no longer present)")  
    print("   â€¢ Regression score (0-100, higher = worse)")
    print("   â€¢ Percentage changes in memory usage")
    
    print("\nğŸ“‹ USAGE EXAMPLES")
    print("-" * 40)
    
    print("\nğŸ”§ 1. BASIC REPORT COMPARISON")
    print("Compare two Valgrind XML files:")
    print("```bash")
    print("python compare_reports.py \\")
    print("  --baseline results/v1.0_valgrind.xml \\")
    print("  --current results/v1.1_valgrind.xml \\")
    print("  --baseline-version 'v1.0' \\")
    print("  --current-version 'v1.1' \\")
    print("  --output comparison_v1.0_vs_v1.1.html")
    print("```")
    
    print("\nğŸ”§ 2. TREND ANALYSIS WITH MEMORY TESTER")
    print("Enable trend tracking during testing:")
    print("```bash")
    print("python memory_leak_analyzer_enhanced.py \\")
    print("  --input results/valgrind.xml \\")
    print("  --version 'build-123' \\")
    print("  --trend-analysis \\")
    print("  --output report.html")
    print("```")
    
    print("\nğŸ”§ 3. CREATE BASELINE FOR TRENDS")
    print("Establish a baseline for future comparisons:")
    print("```bash")
    print("python memory_leak_analyzer_enhanced.py \\")
    print("  --input baseline_valgrind.xml \\")
    print("  --version 'baseline-v1.0' \\")
    print("  --baseline \\")
    print("  --output baseline_report.html")
    print("```")
    
    print("\nğŸ”§ 4. AUTOMATED CI/CD INTEGRATION")
    print("Use in build pipelines:")
    print("```bash")
    print("# Run memory test")
    print("python memory_tester.py --config device.yaml --test")
    print("")
    print("# Compare with baseline and fail if regression")
    print("python compare_reports.py \\")
    print("  --baseline baseline.xml \\")
    print("  --current results/current.xml \\")
    print("  --threshold 20.0 \\")
    print("  --json-output comparison.json")
    print("")
    print("# Exit code 1 if regression score > threshold")
    print("```")
    
    print("\nğŸ“Š UNDERSTANDING RESULTS")
    print("-" * 40)
    
    print("\nğŸ¯ REGRESSION SCORE (0-100)")
    print("â€¢ 0-10: âœ… EXCELLENT (no significant issues)")
    print("â€¢ 11-20: ğŸŸ¡ ACCEPTABLE (minor increases)")
    print("â€¢ 21-50: ğŸŸ  CONCERNING (noticeable regression)")
    print("â€¢ 51-100: ğŸ”´ CRITICAL (major regression)")
    
    print("\nğŸ“ˆ STATUS INDICATORS")
    print("â€¢ IMPROVEMENT: âœ… Fewer leaks and/or bytes")
    print("â€¢ NO_CHANGE: âšª Identical results")
    print("â€¢ MINOR_REGRESSION: ğŸŸ¡ Small increase")
    print("â€¢ REGRESSION: ğŸŸ  Significant increase")
    print("â€¢ MAJOR_REGRESSION: ğŸ”´ Critical increase")
    
    print("\nğŸ” COMPARISON FEATURES")
    print("-" * 40)
    
    print("ğŸ“‹ DETAILED ANALYSIS:")
    print("â€¢ Leak count and byte changes (absolute + percentage)")
    print("â€¢ New leaks introduced (with stack traces)")
    print("â€¢ Fixed leaks (leaks that disappeared)")
    print("â€¢ Severity breakdown comparison")
    print("â€¢ Type breakdown comparison")
    
    print("\nğŸ“Š VISUAL REPORTS:")
    print("â€¢ Interactive HTML reports with color coding")
    print("â€¢ Red = regressions, Green = improvements")
    print("â€¢ Clickable leak details")
    print("â€¢ Export to JSON for further analysis")
    
    print("\nğŸ—ï¸ WORKFLOW INTEGRATION")
    print("-" * 40)
    
    print("\nğŸ”„ DEVELOPMENT WORKFLOW")
    print("1. ğŸ“ Establish baseline:")
    print("   â€¢ Run tests on stable release")
    print("   â€¢ Create baseline with --baseline flag")
    
    print("\n2. ğŸ§ª During development:")
    print("   â€¢ Run memory tests on each build")
    print("   â€¢ Compare against baseline automatically")
    print("   â€¢ Track trends over time")
    
    print("\n3. ğŸš€ Release validation:")
    print("   â€¢ Compare release candidate vs baseline")
    print("   â€¢ Ensure no major regressions")
    print("   â€¢ Update baseline for next cycle")
    
    print("\nğŸ“ FILE LOCATIONS")
    print("-" * 40)
    print("â€¢ Trend database: ~/.memory_leak_analyzer/trends.db")
    print("â€¢ Comparison reports: comparison_report.html")
    print("â€¢ JSON data: comparison.json")
    print("â€¢ Test results: results/ directory")
    
    print("\nâš¡ PERFORMANCE TIPS")
    print("-" * 40)
    print("â€¢ Use version identifiers for easy tracking")
    print("â€¢ Store baseline files for reproducible comparisons")
    print("â€¢ Set appropriate regression thresholds")
    print("â€¢ Archive old reports for historical analysis")
    
    print("\nğŸ¯ BEST PRACTICES")
    print("-" * 40)
    print("âœ… DO:")
    print("â€¢ Compare similar test conditions")
    print("â€¢ Use consistent version naming")
    print("â€¢ Set regression thresholds based on your needs")
    print("â€¢ Review new leaks carefully")
    print("â€¢ Celebrate fixed leaks!")
    
    print("\nâŒ DON'T:")
    print("â€¢ Compare different test scenarios")
    print("â€¢ Ignore minor regressions (they add up)")
    print("â€¢ Set thresholds too high (miss real issues)")
    print("â€¢ Compare incomplete test runs")
    
    print("\nğŸš€ ADVANCED FEATURES")
    print("-" * 40)
    
    print("ğŸ“Š TREND ANALYSIS:")
    print("â€¢ Automatic historical tracking")
    print("â€¢ Pattern recognition over time")
    print("â€¢ Long-term memory health assessment")
    print("â€¢ Build-to-build comparison")
    
    print("\nğŸ” LEAK FINGERPRINTING:")
    print("â€¢ Stack trace + size based matching")
    print("â€¢ Identifies same leaks across builds")
    print("â€¢ Tracks leak lifecycle (new/fixed/persistent)")
    print("â€¢ Handles code changes gracefully")
    
    print("\nğŸ“ˆ REGRESSION SCORING:")
    print("â€¢ Weighted scoring algorithm")
    print("â€¢ Considers leak count, bytes, and new/fixed ratio")
    print("â€¢ Customizable thresholds")
    print("â€¢ CI/CD integration friendly")

def print_examples():
    """Print practical examples"""
    
    print("\n\nğŸ’¡ PRACTICAL EXAMPLES")
    print("=" * 80)
    
    print("\nğŸ“‹ EXAMPLE 1: Compare Two Builds")
    print("-" * 40)
    print("Scenario: You want to compare build 123 vs build 124")
    print()
    print("Steps:")
    print("1. Run memory tests for both builds")
    print("2. Compare the results")
    print("3. Review the HTML report")
    print()
    print("Commands:")
    print("```bash")
    print("# Compare the builds")
    print("python compare_reports.py \\")
    print("  --baseline results/build_123_valgrind.xml \\")
    print("  --current results/build_124_valgrind.xml \\")
    print("  --baseline-version 'build-123' \\")
    print("  --current-version 'build-124' \\")
    print("  --output build_123_vs_124.html")
    print()
    print("# Open the report")
    print("open build_123_vs_124.html")
    print("```")
    
    print("\nğŸ“‹ EXAMPLE 2: CI/CD Pipeline Integration")
    print("-" * 40)
    print("Scenario: Fail CI build if memory regressions detected")
    print()
    print("Pipeline script:")
    print("```bash")
    print("#!/bin/bash")
    print("set -e")
    print()
    print("# Run memory leak testing")
    print("python memory_tester.py --config ci_config.yaml --test")
    print()
    print("# Compare with baseline (exit 1 if regression)")
    print("python compare_reports.py \\")
    print("  --baseline baseline/production_baseline.xml \\")
    print("  --current results/current_test.xml \\")
    print("  --current-version \"$BUILD_NUMBER\" \\")
    print("  --threshold 15.0 \\")
    print("  --json-output artifacts/comparison.json")
    print()
    print("echo \"Memory leak comparison completed\"")
    print("```")
    
    print("\nğŸ“‹ EXAMPLE 3: Long-term Trend Tracking")
    print("-" * 40)
    print("Scenario: Track memory health over multiple releases")
    print()
    print("Commands:")
    print("```bash")
    print("# For each release, record trend data")
    print("python memory_leak_analyzer_enhanced.py \\")
    print("  --input release_v2.1_valgrind.xml \\")
    print("  --version 'v2.1.0' \\")
    print("  --trend-analysis \\")
    print("  --output v2.1_report.html")
    print()
    print("python memory_leak_analyzer_enhanced.py \\")
    print("  --input release_v2.2_valgrind.xml \\")
    print("  --version 'v2.2.0' \\")
    print("  --trend-analysis \\")
    print("  --output v2.2_report.html")
    print()
    print("# View trend database")
    print("sqlite3 ~/.memory_leak_analyzer/trends.db \\")
    print("  \"SELECT version, total_leaks, total_bytes FROM trend_points ORDER BY timestamp;\"")
    print("```")

def main():
    """Main function"""
    print_guide()
    print_examples()
    
    print("\n\nğŸ‰ CONCLUSION")
    print("=" * 80)
    print("Report comparison and trend analysis provide powerful insights into")
    print("memory leak patterns and help maintain code quality over time.")
    print()
    print("Key benefits:")
    print("â€¢ ğŸ” Early detection of memory regressions")
    print("â€¢ ğŸ“Š Quantifiable memory health metrics")  
    print("â€¢ ğŸš€ Automated CI/CD integration")
    print("â€¢ ğŸ“ˆ Long-term trend visibility")
    print("â€¢ âœ… Objective improvement tracking")
    print()
    print("Start with basic comparisons and gradually integrate trend analysis")
    print("into your development workflow for maximum benefit!")

if __name__ == "__main__":
    main() 